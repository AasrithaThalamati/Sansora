<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Checkout - Sansora</title>
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .checkout-container {
            max-width: 1200px;
            margin: 100px auto 2rem;
            padding: 0 2rem;
        }
        
        .checkout-header {
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 3rem;
            box-shadow: 0 10px 40px rgba(74, 144, 226, 0.3);
        }
        
        .checkout-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        .checkout-content {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 2rem;
        }
        
        .checkout-form {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        }
        
        .form-section {
            margin-bottom: 2.5rem;
        }
        
        .form-section h2 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 3px solid #4a90e2;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.4rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.6rem;
            font-weight: 600;
            color: #34495e;
            font-size: 0.95rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e8ecf1;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4a90e2;
            background: white;
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .payment-methods {
            display: grid;
            gap: 1rem;
        }
        
        .payment-option {
            padding: 1.2rem;
            border: 2px solid #e8ecf1;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f8f9fa;
        }
        
        .payment-option:hover {
            border-color: #4a90e2;
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.15);
        }
        
        .payment-option input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: #4a90e2;
        }
        
        .payment-option.selected {
            border-color: #4a90e2;
            background: #e3f2fd;
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.2);
        }
        
        .order-summary {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
            height: fit-content;
            position: sticky;
            top: 100px;
        }
        
        .order-summary h2 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            padding-bottom: 0.8rem;
            border-bottom: 3px solid #4a90e2;
            font-size: 1.4rem;
        }
        
        .cart-item-summary {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 1px solid #ecf0f1;
            margin-bottom: 1rem;
        }
        
        .cart-item-summary img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .item-summary-details {
            flex: 1;
        }
        
        .item-summary-details h4 {
            color: #2c3e50;
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
        }
        
        .item-summary-details .quantity {
            color: #7f8c8d;
            font-size: 0.85rem;
        }
        
        .item-summary-price {
            font-weight: 700;
            color: #4a90e2;
            font-size: 1.1rem;
        }
        
        .summary-totals {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid #ecf0f1;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        
        .summary-row.total {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            padding-top: 1rem;
            border-top: 2px solid #4a90e2;
        }
        
        .place-order-btn {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 5px 20px rgba(74, 144, 226, 0.3);
        }
        
        .place-order-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(74, 144, 226, 0.4);
        }
        
        .place-order-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .place-order-btn:active {
            transform: translateY(-1px);
        }
        
        .security-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: #27ae60;
            font-size: 0.9rem;
        }

        .empty-cart-message {
            text-align: center;
            padding: 3rem 2rem;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .empty-cart-message i {
            font-size: 4rem;
            color: #ccc;
            margin-bottom: 1rem;
        }

        .empty-cart-message h3 {
            color: #333;
            margin-bottom: 1rem;
        }

        .empty-cart-message p {
            color: #666;
            margin-bottom: 1.5rem;
        }

        .continue-shopping-btn {
            display: inline-block;
            padding: 0.8rem 2rem;
            background: #4a90e2;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .continue-shopping-btn:hover {
            background: #357abd;
            transform: translateY(-2px);
        }

        /* Success Popup */
        .success-popup {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: none; justify-content: center; align-items: center;
            z-index: 9999;
        }
        .popup-content {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            animation: pop 0.4s ease-out;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        @keyframes pop {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .popup-content i {
            font-size: 4rem;
            color: #27ae60;
            margin-bottom: 1rem;
        }
        .popup-content h2 {
            color: #2c3e50;
            margin-bottom: 1rem;
        }
        .popup-content .btn {
            background: #4a90e2;
            color: white;
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            font-weight: 600;
        }

        /* Wallet + COD Info */
        .wallet-cod-info {
            background: #e8f5e9;
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
            font-size: 0.95rem;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        @media (max-width: 968px) {
            .checkout-content { grid-template-columns: 1fr; }
            .order-summary { position: static; }
            .form-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="logo-black.png" alt="Sansora Logo" class="logo">
            </div>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="deals.html" class="nav-link">Deals</a></li>
                <li><a href="orders.html" class="nav-link">Orders</a></li>
                <li><a href="cart.html" class="nav-link">Cart (<span id="cart-count">0</span>)</a></li>
                <li><a href="#" class="nav-link" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="checkout-container">
        <div class="checkout-header">
            <h1>Secure Checkout</h1>
            <p>Complete your order safely and securely</p>
        </div>

        <div class="checkout-content">
            <div class="checkout-form">
                <form id="checkoutForm">
                    <!-- Shipping Information -->
                    <div class="form-section">
                        <h2>Shipping Information</h2>
                        <div class="form-group">
                            <label for="fullName">Full Name *</label>
                            <input type="text" id="fullName" required placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" required placeholder="your.email@example.com">
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" id="phone" required placeholder="+91 98765 43210">
                        </div>
                        <div class="form-group">
                            <label for="address">Street Address *</label>
                            <input type="text" id="address" required placeholder="House/Flat No., Street Name">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">City *</label>
                                <input type="text" id="city" required placeholder="City">
                            </div>
                            <div class="form-group">
                                <label for="state">State *</label>
                                <input type="text" id="state" required placeholder="State">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pincode">PIN Code *</label>
                                <input type="text" id="pincode" required placeholder="400001">
                            </div>
                            <div class="form-group">
                                <label for="country">Country *</label>
                                <input type="text" id="country" value="India" required>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="form-section">
                        <h2>Payment Method</h2>
                        <div class="payment-methods">
                            <label class="payment-option">
                                <input type="radio" name="payment" value="card" required>
                                <span>Credit/Debit Card</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="payment" value="upi" required>
                                <span>UPI Payment</span  >
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="payment" value="netbanking" required>
                                <span>Net Banking</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="payment" value="wallet" required>
                                <span>Sansora Wallet</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="payment" value="cod" required>
                                <span>Cash on Delivery</span>
                            </label>
                        </div>
                    </div>

                    <!-- Card Details -->
                    <div class="form-section" id="cardDetails" style="display: none;">
                        <h2>Card Details</h2>
                        <div class="form-group">
                            <label for="cardNumber">Card Number</label>
                            <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                        </div>
                        <div class="form-group">
                            <label for="cardName">Cardholder Name</label>
                            <input type="text" id="cardName" placeholder="Name on Card">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expiry">Expiry Date</label>
                                <input type="text" id="expiry" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" placeholder="123" maxlength="3">
                            </div>
                        </div>
                    </div>

                    <!-- UPI QR Code Section -->
                    <div class="form-section" id="upiDetails" style="display: none;">
                        <h2>UPI Payment</h2>
                        <div style="text-align: center; padding: 1.5rem; background: #f8f9fa; border-radius: 16px; border: 2px dashed #4a90e2;">
                            <img id="upiQR" src="" alt="UPI QR Code" style="width: 180px; height: 180px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                            <p style="margin: 1rem 0 0.5rem; font-weight: 600; color: #2c3e50;">Scan with any UPI app</p>
                            <p style="margin: 0.5rem 0; color: #7f8c8d; font-size: 0.9rem;">
                                Amount: <strong id="upiAmount">₹0</strong>
                            </p>
                            <p style="margin: 0.5rem 0 1rem; color: #7f8c8d; font-size: 0.9rem;">
                                UPI ID: <code id="upiId" style="background:#e9ecef;padding:0.2rem 0.5rem;border-radius:6px;">sansora@upi</code>
                                <button type="button" onclick="copyUPI()" style="margin-left:0.5rem;background:none;border:none;color:#4a90e2;cursor:pointer;font-weight:600;">Copy</button>
                            </p>
                            <div id="upiTimer" style="color:#e74c3c;font-weight:600;margin-top:1rem;display:none;">
                                Expires in: <span id="timer">05:00</span>
                            </div>
                            <button type="button" id="upiPaidBtn" class="place-order-btn" style="margin-top:1.5rem;display:none;" onclick="mockUPIPayment()">
                                I have paid
                            </button>
                        </div>
                    </div>

                    <!-- Net Banking Mock Section -->
                    <div class="form-section" id="netbankingDetails" style="display: none;">
                        <h2>Net Banking</h2>
                        <div style="background:#f8f9fa;padding:1.5rem;border-radius:16px;border:2px dashed #4a90e2;">
                            <div class="form-group">
                                <label for="bankSelect">Select Your Bank</label>
                                <select id="bankSelect" style="width:100%;padding:0.8rem;border-radius:8px;border:2px solid #e8ecf1;">
                                    <option value="">-- Choose Bank --</option>
                                    <option value="hdfc">HDFC Bank</option>
                                    <option value="sbi">State Bank of India</option>
                                    <option value="icici">ICICI Bank</option>
                                    <option value="axis">Axis Bank</option>
                                    <option value="kotak">Kotak Mahindra</option>
                                </select>
                            </div>
                            <div id="bankLogin" style="display:none;margin-top:1rem;">
                                <div class="form-group">
                                    <label for="bankUser">User ID / Customer ID</label>
                                    <input type="text" id="bankUser" placeholder="Enter User ID" style="padding:0.8rem;border-radius:8px;">
                                </div>
                                <div class="form-group">
                                    <label for="bankPass">Password</label>
                                    <input type="password" id="bankPass" placeholder="Enter Password" style="padding:0.8rem;border-radius:8px;">
                                </div>
                                <p style="font-size:0.85rem;color:#e74c3c;margin:0.5rem 0;">
                                    <strong>Demo Login:</strong> user / 1234
                                </p>
                                <button type="button" id="netbankPayBtn" class="place-order-btn" style="margin-top:1rem;" onclick="mockNetbankingPayment()">
                                    Pay Now
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Wallet + COD Payment (REAL) -->
                    <div class="form-section" id="walletDetails" style="display: none;">
                        <h2>Wallet + COD</h2>
                        <div style="background:#f8f9fa;padding:1.5rem;border-radius:16px;border:2px dashed #4a90e2;">
                            <p style="margin:0.5rem 0;font-weight:600;color:#2c3e50;">
                                Wallet Balance: <strong id="walletBalanceDisplay">₹0</strong>
                            </p>
                            <div id="walletCodInfo" class="wallet-cod-info" style="display:none;"></div>
                            <div class="form-group" style="margin-top:1rem;">
                                <label for="walletPinInput">Enter 4-digit PIN</label>
                                <input type="password" id="walletPinInput" placeholder="****" maxlength="4" style="padding:0.8rem;border-radius:8px;">
                            </div>
                            <p style="font-size:0.85rem;color:#e74c3c;margin:0.5rem 0;">
                                <strong>Demo PIN:</strong> 1234
                            </p>
                            <button type="button" id="walletPayBtn" class="place-order-btn" style="margin-top:1rem;" onclick="processWalletCOD()">
                                Pay with Wallet + COD
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
                <h2>Order Summary</h2>
                <div id="cartContent">
                    <div class="empty-cart-message">
                        <h3>Loading your cart...</h3>
                    </div>
                </div>
                <div class="summary-totals" id="summaryTotals" style="display: none;">
                    <div class="summary-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">₹0</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping:</span>
                        <span id="shipping">₹99</span>
                    </div>
                    <div class="summary-row">
                        <span>GST (10%):</span>
                        <span id="tax">₹0</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span id="total">₹0</span>
                    </div>
                </div>
                <button type="button" class="place-order-btn" id="placeOrderBtn" onclick="placeOrder()" disabled>
                    Place Order
                </button>
                <div class="security-badge">
                    <span>Secure Payment - Your data is protected</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Popup -->
    <div class="success-popup" id="successPopup">
        <div class="popup-content">
            <h2>Payment Successful!</h2>
            <p>Your order has been placed successfully.</p>
            <button class="btn" onclick="window.location.href='orders.html'">View Orders</button>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Sansora</h3>
                <p>Your trusted partner for premium quality products at the best prices.</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="orders.html">Orders</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="signup.html">Sign Up</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Contact Info</h4>
                <p>+91 98765 43210</p>
                <p>support@sansora.com</p>
                <p>Mumbai, India</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2024 Sansora. All rights reserved. | Designed with love for premium shopping experience</p>
        </div>
    </footer>

    <script>
        let checkoutCart = [];
        let subtotal = 0, shipping = 99, tax = 0, total = 0;
        let upiTimerInterval;

        // === WALLET INTEGRATION ===
        const WALLET_KEY_PREFIX = 'sansora_wallet_';
        let userData = null;
        let walletData = { balance: 0, transactions: [] };

        function loadUser() {
            const saved = localStorage.getItem('sansora_user');
            if (!saved) {
                alert('Please login first');
                setTimeout(() => location.href = 'login.html', 1000);
                return false;
            }
            try { userData = JSON.parse(saved); } catch (e) {}
            return true;
        }

        function loadWallet() {
            if (!userData?.username) return;
            const key = WALLET_KEY_PREFIX + userData.username;
            const saved = localStorage.getItem(key);
            if (saved) {
                try { walletData = JSON.parse(saved); } catch (e) {}
            }
            const el = document.getElementById('walletBalanceDisplay');
            if (el) {
                el.textContent = `₹${walletData.balance.toLocaleString('en-IN')}`;
            }
        }

        function saveWallet() {
            if (!userData?.username) return;
            const key = WALLET_KEY_PREFIX + userData.username;
            localStorage.setItem(key, JSON.stringify(walletData));
        }

        function processWalletCOD() {
            const pin = document.getElementById('walletPinInput').value.trim();
            if (!pin) return alert('Enter 4-digit PIN');
            if (pin !== '1234') return alert('Invalid PIN. Use: 1234');

            if (walletData.balance >= total) {
                // Full wallet payment
                const txn = {
                    type: 'debit',
                    amount: total,
                    description: `Full payment – ${checkoutCart.length} item${checkoutCart.length > 1 ? 's' : ''}`,
                    date: new Date().toLocaleString('en-GB', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })
                };
                walletData.balance -= total;
                walletData.transactions.push(txn);
                saveWallet();
                placeOrderSuccess('WALLET');
            } else {
                // Partial + COD
                const codAmount = total - walletData.balance;
                const txn = {
                    type: 'debit',
                    amount: walletData.balance,
                    description: `Partial payment (COD: ₹${codAmount})`,
                    date: new Date().toLocaleString('en-GB', { day: 'numeric', month: 'short', year: 'numeric', hour: '2-digit', minute: '2-digit' })
                };
                walletData.balance = 0;
                walletData.transactions.push(txn);
                saveWallet();

                document.getElementById('walletCodInfo').innerHTML = `
                    <strong>₹${walletData.balance.toLocaleString('en-IN')} paid from wallet</strong><br>
                    <strong>₹${codAmount.toLocaleString('en-IN')} to be paid in Cash on Delivery</strong>
                `;
                document.getElementById('walletCodInfo').style.display = 'block';

                setTimeout(() => {
                    placeOrderSuccess('WALLET+COD', codAmount);
                }, 1500);
            }
        }
        // === END WALLET INTEGRATION ===

        window.addEventListener('DOMContentLoaded', () => {
            if (!loadUser()) return;
            loadWallet();
            loadCheckoutCart();
            setupPaymentOptions();
            setupCardFormatting();
        });

        function loadCheckoutCart() {
            try {
                const saved = localStorage.getItem('cart');
                if (!saved || saved === '[]') return showEmptyCart();

                checkoutCart = JSON.parse(saved);
                if (!Array.isArray(checkoutCart) || checkoutCart.length === 0) return showEmptyCart();

                displayCartSummary();
                calculateTotals();
                document.getElementById('placeOrderBtn').disabled = false;
                updateCartCount();
            } catch (e) {
                console.error(e);
                showEmptyCart();
            }
        }

        function showEmptyCart() {
            document.getElementById('cartContent').innerHTML = `
                <div class="empty-cart-message">
                    <h3>Your cart is empty</h3>
                    <p>Add items before checking out</p>
                    <a href="index.html" class="continue-shopping-btn">Continue Shopping</a>
                </div>`;
            document.getElementById('summaryTotals').style.display = 'none';
            document.getElementById('placeOrderBtn').disabled = true;
        }

        function displayCartSummary() {
            const container = document.getElementById('cartContent');
            let html = '';
            checkoutCart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                html += `
                    <div class="cart-item-summary">
                        <img src="${item.image}" alt="${item.title}" onerror="this.src='https://via.placeholder.com/70'">
                        <div class="item-summary-details">
                            <h4>${item.title}</h4>
                            <p class="quantity">Qty: ${item.quantity}</p>
                        </div>
                        <div class="item-summary-price">₹${itemTotal.toLocaleString('en-IN')}</div>
                    </div>`;
            });
            container.innerHTML = html;
            document.getElementById('summaryTotals').style.display = 'block';
        }

        function calculateTotals() {
            subtotal = checkoutCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            shipping = subtotal > 999 ? 0 : 99;
            tax = Math.round(subtotal * 0.10);
            total = subtotal + shipping + tax;

            document.getElementById('subtotal').textContent = '₹' + subtotal.toLocaleString('en-IN');
            document.getElementById('shipping').textContent = shipping === 0 ? 'FREE' : '₹' + shipping;
            document.getElementById('tax').textContent = '₹' + tax.toLocaleString('en-IN');
            document.getElementById('total').textContent = '₹' + total.toLocaleString('en-IN');
        }

        function setupPaymentOptions() {
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    opt.querySelector('input').checked = true;

                    document.getElementById('cardDetails').style.display = 'none';
                    hideUPISection();
                    hideNetbankingSection();
                    hideWalletSection();

                    const val = opt.querySelector('input').value;
                    if (val === 'card') {
                        document.getElementById('cardDetails').style.display = 'block';
                    } else if (val === 'upi') {
                        showUPISection();
                    } else if (val === 'netbanking') {
                        showNetbankingSection();
                    } else if (val === 'wallet') {
                        showWalletSection();
                    }
                });
            });
        }

        function setupCardFormatting() {
            const cardNum = document.getElementById('cardNumber');
            if (cardNum) cardNum.addEventListener('input', e => {
                let v = e.target.value.replace(/\s/g, '').replace(/\D/g, '');
                e.target.value = v.match(/.{1,4}/g)?.join(' ') || v;
            });

            const expiry = document.getElementById('expiry');
            if (expiry) expiry.addEventListener('input', e => {
                let v = e.target.value.replace(/\D/g, '');
                if (v.length >= 2) v = v.slice(0,2) + '/' + v.slice(2,4);
                e.target.value = v;
            });
        }

        function placeOrder() {
            const form = document.getElementById('checkoutForm');
            if (!form.checkValidity()) return form.reportValidity();

            const payment = document.querySelector('input[name="payment"]:checked');
            if (!payment) return alert('Select a payment method');

            const method = payment.value;

            if (method === 'card') {
                const card = document.getElementById('cardNumber').value.replace(/\s/g, '');
                if (card.length !== 16) return alert('Invalid card number');
                if (!document.getElementById('cardName').value) return alert('Enter cardholder name');
                if (!/^\d{2}\/\d{2}$/.test(document.getElementById('expiry').value)) return alert('Invalid expiry');
                if (!/^\d{3,4}$/.test(document.getElementById('cvv').value)) return alert('Invalid CVV');
            }

            if (checkoutCart.length === 0) return alert('Cart is empty');

            const btn = document.getElementById('placeOrderBtn');
            btn.disabled = true;
            btn.innerHTML = 'Processing...';

            setTimeout(() => {
                placeOrderSuccess(method.toUpperCase());
            }, 1500);
        }

        function updateCartCount() {
            const count = checkoutCart.reduce((sum, i) => sum + i.quantity, 0);
            const el = document.getElementById('cart-count');
            if (el) el.textContent = count;
        }

        // === UPI, NETBANKING, MOCKS ===
        function showUPISection() {
            document.getElementById('upiDetails').style.display = 'block';
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=sansora@upi&pn=Sansora&am=${total}&cu=INR`;
            document.getElementById('upiQR').src = qrUrl;
            document.getElementById('upiAmount').textContent = '₹' + total.toLocaleString('en-IN');
            startUPITimer();
        }

        function hideUPISection() {
            document.getElementById('upiDetails').style.display = 'none';
            clearInterval(upiTimerInterval);
            document.getElementById('upiTimer').style.display = 'none';
            document.getElementById('upiPaidBtn').style.display = 'none';
        }

        function startUPITimer() {
            let seconds = 300;
            document.getElementById('upiTimer').style.display = 'block';
            document.getElementById('upiPaidBtn').style.display = 'block';

            upiTimerInterval = setInterval(() => {
                seconds--;
                const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                document.getElementById('timer').textContent = `${mins}:${secs}`;
                if (seconds <= 0) {
                    clearInterval(upiTimerInterval);
                    alert('UPI payment expired. Please try again.');
                    hideUPISection();
                }
            }, 1000);
        }

        function copyUPI() {
            const upiId = document.getElementById('upiId').textContent;
            navigator.clipboard.writeText(upiId).then(() => {
                const btn = document.querySelector('#upiDetails button[onclick="copyUPI()"]');
                const orig = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = orig, 2000);
            });
        }

        function mockUPIPayment() {
            clearInterval(upiTimerInterval);
            const btn = document.getElementById('upiPaidBtn');
            btn.disabled = true;
            btn.innerHTML = 'Processing...';
            setTimeout(() => {
                placeOrderSuccess('UPI');
            }, 1500);
        }

        function showNetbankingSection() {
            document.getElementById('netbankingDetails').style.display = 'block';
            document.getElementById('bankSelect').selectedIndex = 0;
            document.getElementById('bankLogin').style.display = 'none';
        }

        function hideNetbankingSection() {
            document.getElementById('netbankingDetails').style.display = 'none';
            document.getElementById('bankLogin').style.display = 'none';
        }

        document.getElementById('bankSelect')?.addEventListener('change', function() {
            if (this.value) {
                document.getElementById('bankLogin').style.display = 'block';
            } else {
                document.getElementById('bankLogin').style.display = 'none';
            }
        });

        function mockNetbankingPayment() {
            const user = document.getElementById('bankUser').value.trim();
            const pass = document.getElementById('bankPass').value;

            if (!user || !pass) return alert('Enter User ID and Password');
            if (user !== 'user' || pass !== '1234') return alert('Invalid credentials. Use: user / 1234');

            const btn = document.getElementById('netbankPayBtn');
            btn.disabled = true;
            btn.innerHTML = 'Processing...';

            setTimeout(() => {
                placeOrderSuccess('NETBANKING');
            }, 1500);
        }

        function showWalletSection() {
            document.getElementById('walletDetails').style.display = 'block';
            loadWallet();
            document.getElementById('walletCodInfo').style.display = 'none';
        }

        function hideWalletSection() {
            document.getElementById('walletDetails').style.display = 'none';
        }

        // === FINAL SUCCESS ===
        function placeOrderSuccess(method, codAmount = 0) {
            const order = {
                id: 'ORD-' + Date.now(),
                date: new Date().toLocaleDateString('en-IN'),
                items: checkoutCart,
                subtotal, shipping, tax, total,
                status: method.includes('COD') ? 'Pending COD' : 'Paid',
                paymentMethod: method,
                codAmount: codAmount,
                shippingInfo: {
                    name: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    pincode: document.getElementById('pincode').value,
                    country: document.getElementById('country').value
                }
            };

            let orders = JSON.parse(localStorage.getItem('user_orders') || '[]');
            orders.push(order);
            localStorage.setItem('user_orders', JSON.stringify(orders));
            localStorage.removeItem('cart');

            document.getElementById('successPopup').style.display = 'flex';
            document.getElementById('placeOrderBtn').disabled = false;
            document.getElementById('placeOrderBtn').innerHTML = 'Place Order';
        }
    </script>
</body>
</html>